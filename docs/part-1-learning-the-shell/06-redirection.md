# 6. 重定向

本章中，我们将释放可能是命令行中最佳的特性。<u>输入输出重定向</u>（*I/O redirection*）。「I/O」代表 *input/output*，伴随这个功能，我们能从文件输入命令，也能把命令的输出重定向到文件，我们可以将多个命令连接成一个命令<u>管道</u>（*pipelines*）。要展示这个功能，我们来介绍下面几个命令：

- `cat` 连接文件
- `sort` 对文本行排序
- `uniq` 报告或忽略重复的行
- `grep` 打印匹配字符模式的行
- `wc` 打印文件的行数、词数和字节数
- `head` 输出文件的开头部分
- `tail` 输出文件的结尾部分
- `tee` 从标准输入读取文件，写入标准输出和文件

## 标准输入，标准输出，错误

目前为止我们所接触到的很多程序都会产生某种输出。输出通常有两种类型组成：

- 程序的结果，即程序按设计所产生的数据
- 状态及错误信息，用以告知我们如何使用程序

如果我们看到 `ls` 命令，我们可以看到它在屏幕上显示结果和错误信息。

坚持 Unix 「一切皆文件」的主题，像 `ls` 这样的程序实际上将他们的计算结果送到了一个叫<u>标准输出</u>（*standard output* 经常写成 *stdout*）的特殊文件中，将他们的状态信息送到另一个叫<u>标准错误</u>（*standard error* 经常写成 *stderr*）的文件中。默认情况下，两者都被连接到屏幕而非磁盘文件。

另外，许多程序从<u>标准输入</u>（*standard input* 经常写成 *stdin*）的设备中取得输入，默认情况下，附加到键盘。

I/O 重定向允许我们改变输出的去向和输入的来源。正常情况下，输出到屏幕、输入自键盘，但运用重定向，我们能改变这种情况。

## 重定向标准输出

I/O 重定向允许我们重新定义标准输出的去向。要重定向标准输出到另一个文件而非屏幕，我们用 `>` 重定向操作符，并跟随文件名。为何我们要这样做呢？通常，存储一个命令的输出为一个文件非常有用。例如，我们告诉 shell，将 `ls` 命令的输出送到 `ls-output.txt` 文件而非屏幕中：

```bash
[me@linuxbox ~]$ ls -l /usr/bin > ls-output.txt
```

这里我们创建了一个 `/usr/bin` 目录中的文件清单，并将结果保存到了文件 `ls-output.txt` 中。让我们检查重定向命令：

```bash
[me@linuxbox ~]$ ls -l ls-output.txt
-rw-rw-r-- 1 me me 167878 2018-02-01 15:07 ls-output.txt
```

很好，一个很大的文本文件。如果我们用 `less` 查看文件，我们可以看到文件确实包含了之前 `ls` 命令的结果。

```bash
[me@linuxbox ~]$ less ls-output.txt
```

现在来重复我们的重定向测试，但是这次来点绕的，我们把目录名改成一个并不存在的目录：

```bash
[me@linuxbox ~]$ ls -l /bin/usr > ls-output.txt
ls: cannot access /bin/usr: No such file or directory
```

我们收到了一个错误信息。这是合理的，因为我们指定了一个不存在的目录 `/bin/usr`，但是为何错误信息是显示在屏幕上而非显示在重定向文件 `ls-output.txt` 中呢？答案是，`ls` 程序没有将错误信息传送到标准输出。类似大多数优秀的 Unix 程序，它把错误信息传送到了标准错误。我们随后将看到如何重定向标准错误，但是首先让我们看下输出文件：

```bash
[me@linuxbox ~]$ ls -l ls-output.txt
-rw-rw-r-- 1 me me 0 2018-02-01 15:08 ls-output.txt
```

文件现在是 0 字节长度了！这是因为我们用 `>` 重定向了输出，而目标文件总是从文件开头被重写。因为我们的 `ls` 命令没有生成结果，而仅仅得到一个错误信息，重定向操作开始重写文件，随即因错误而停止，导致文件被截断。实际上，如果我们需要截断一个文件（或创建一个新的空文件），我们可以用这样的技巧：

```bash
[me@linuxbox ~]$ > ls-output.txt
```

没有前置命令，简单的使用重定向操作符，将清空一个已存在的文件，或创建一个新的空文件。

那我们怎么能把重定向结果附加到现有文件而不是从文件开始处覆盖文件呢？我们用 `>>` 重定向操作符：

```bash
[me@linuxbox ~]$ ls -l /usr/bin >> ls-output.txt
```

使用 `>>` 操作符将结果附加到一个文件中。如果该文件不存在，将直接创建文件。来测试一下：

```bash
[me@linuxbox ~]$ ls -l /usr/bin >> ls-output.txt
[me@linuxbox ~]$ ls -l /usr/bin >> ls-output.txt
[me@linuxbox ~]$ ls -l /usr/bin >> ls-output.txt
[me@linuxbox ~]$ ls -l ls-output.txt
-rw-rw-r-- 1 me me 503634 2018-02-01 15:45 ls-output.txt
```

我们重复了三次命令，导致输出文件是一次输出文件的三倍大小。

## 重定向标准错误

