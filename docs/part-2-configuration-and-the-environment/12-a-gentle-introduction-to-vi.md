# 12. vi 简明教程

有个旧时的笑话，一个观光客来到纽约，问一个过路人如何去著名的古典音乐厅：

访客：对不起，我怎么去卡内基音乐厅？

路人：练习，练习，练习！

学习 Linux 命令行，和要成为技艺精湛的钢琴家一样，不是在一个下午要去学的东西，而是要花费多年的练习。在本章中，我们将介绍 `vi`（读作「vee  eye」）文本编辑器，一个在 Unix 传统中的核心程序。`vi` 以其难学的用户界面而知名，但是当我们看到一个大师坐在键盘边上开始「演奏」的时候，就会真正见证伟大的艺术。在本章中我们不想要成为大师，当结束本章之后，将知道如何在 `vi` 用「筷子」。

## 为何要学习 vi

在当前这个既有图形编辑器又有易用如 `nano` 的文本编辑器的时代，为何我们要学 `vi`？这里有三条理由。

- `vi` 几乎总是可用。如果我们的系统没有图形界面，`vi` 就像是一个救生圈，比如一台远程服务器或没有被正确配置 X 的本地系统。`nano` 正在越来越大众化，但是还不够通用。`POSIX` 是 Unix 系统上程序兼容性的标准，它要求 `vi` 存在。
- `vi` 轻量且快速。对于多数任务，相比找到菜单里的图形文本编辑器并等待其装载几兆字节的文件来说，`vi` 更易于打开。另外，`vi` 专为快速打字设计。如我们将要看到的，熟练的 `vi` 用户不会在编辑时将其手指从键盘上抬起。
- 我们不想让其他 Linux 用户觉得我们是懦夫。

好吧，就算两条理由吧。

## 一点背景

初版 `vi` 由 Bill Joy 在 1976 年写就，他是加利福尼亚大学伯克利分校的学生，日后成为太阳微系统（Sun Microsystems）的共同创始人之一。`vi` 的名字源自单词「visual」，因为它旨在允许使用移动光标在视频终端上进行编辑。在<u>可视编辑器</u>（*visual editors*）之前，是在一个时间内仅可操作单行文本的<u>行编辑器</u>（*line editors*）。要指定一处变更，我们要告知行编辑器到指定行并描述作何种变更，如增加或删除文本等。随着视频终端的到来（相比较打印终端如电子打字机），可视编辑成为可能。`vi` 实际上合并了一个功能强大的行编辑器 `ex`，所以我们在用 `vi` 的时候，也可以使用行编辑器命令。

大多数 Linux 发行版并不包含真正的 `vi`，而是装载着一个增强替换版 `vim`（即「vi improved」的简称），由 Bram Moolenaar 写就。`vim` 在传统的 Unix `vi` 上作了大量改进，通常被符号链接（或别名化）为 Linux 系统中的 `vi`。在以下的讨论中，我们将假定我们所说的 `vi` 实际上是 `vim` 程序。

## 启动与结束 vi

要启动 `vi`，我们简单地键入：

```bash
[me@linuxbox ~]$ vi
```

将会显示如下屏幕：

![vi-startup](../images/vi-startup.jpg)

和我们之前用 `nano` 一样，第一个要学的是如何退出。键入下列命令（注意冒号是命令的一个组成部分）：

```bash
:q
```

将返回 Shell 提示符。如果因为某些原因，`vi` 没有退出（通常是因为我们对一个文件作了些更改单没有保存），我们可以加一个感叹号来告诉 `vi` 我们真的要退出。

```bash
:q!
```

> **技巧：**如果在 `vi` 中迷路了，试着按两次 `Esc`。

> **兼容模式**
>
> 在上面的启动画面中，我们看到「Running in Vi compatible mode」字样，是说 `vim` 将运行在一个更接近 `vi` 的正常行为，而非 `vim` 的增强行为的模式中。出于本章中所需要，我们将让 `vim` 运行其增强行为。有几个选项可以做到这点。试着运行 `vim` 而非 `vi`，如果能成功，就考虑将 `alias vi='vim'` 加入到你的 `.bashrc` 文件中。或者，用下列命令加入一行到你的 `vim` 配置文件中：
>
> `echo "set nocp" >> ~/.vimrc`
>
> 不同的 Linux 发行版有不同的 `vim` 封装方式。有些默认安装了一个最小版本的仅支持有限的 `vim` 特性。在下列课程中，你可能会遇到那些丢失了的特性，为此，请安装完整版本的 `vim`。

## 编辑模式



### 进入插入模式



### 保存工作



## 到处移动光标



## 基本编辑



### 附加文本



### 操作一行



### 删除文本



### 剪切、复制、粘贴文本



### 加入行



## 查找与替换



### 行内检索



### 全文检索



### 全局查找与替换



## 编辑多个文件



### 在文件间切换



### 打开附加文件以编辑



### 从一个文件中复制内容到另一文件



### 将整个文件插入到另一文件



## 保存工作



## 总结



## 扩展阅读

